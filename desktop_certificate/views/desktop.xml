<?xml version="1.0" encoding="UTF-8" ?>
<!-- Copyright (C) 2024 Akretion (<http://www.akretion.com>).
@author Kévin Roche <kevin.roche@akretion.com>  -->
<odoo>
<record id="desktop_certificate_action" model="ir.actions.act_window">
    <field name="name">Certificats</field>
    <field name="res_model">desktop.certificate</field>
    <field name="view_mode">tree</field>
    <field name="domain">[("desktop_id", "=", active_id)]</field>
    <field name="context">{"active_test": False}</field>
</record>


<!-- form view -->
<record id="desktop_form" model="ir.ui.view">
    <field name="model">desktop</field>
    <field name="arch" type="xml">
        <form>
            <header>
                <button
                        name="generate_certificate"
                        string="Créer un certificat"
                        type="object"
                    />
            </header>
            <sheet>
                <div class="oe_button_box" name="button_box">
                    <button
                            name="%(desktop_certificate_action)d"
                            type="action"
                            class="oe_stat_button"
                            icon="fa-file-archive-o"
                        >
                        <field
                                string="Certificat(s)"
                                name="valid_certificate_count"
                                widget="statinfo"
                            />
                    </button>
                </div>
                <group>
                    <field name="name" />
                    <field name="address_id" />
                    <field name="certificate_state" />
                </group>
                <group string="Utilisateur">
                    <field name="certificate_partner_id" />
                    <field name="certificate_email" readonly="1" />
                    <field name="certificate_phone" readonly="1" />
                </group>
            </sheet>
        </form>
    </field>
</record>


<!-- tree view -->
<record id="desktop_tree" model="ir.ui.view">
    <field name="model">desktop</field>
    <field name="arch" type="xml">
        <tree
                decoration-warning="certificate_state == '2_medium'"
                decoration-danger="certificate_state == '1_short'"
            >
            <field name="name" />
            <field name="address_id" />
            <field name="certificate_state" />
            <field name="certificate_partner_id" />
        </tree>
    </field>
</record>


<!-- search view -->
<record id="desktop_search" model="ir.ui.view">
    <field name="model">desktop</field>
    <field name="arch" type="xml">
        <search>
            <filter
                    name="certificate_state"
                    string=" Etat du certificat"
                    domain="[]"
                    context="{'group_by':'certificate_state'}"
                />
            <filter
                    name="certificate_partner_id"
                    string="Utilisateur"
                    domain="[]"
                    context="{'group_by':'certificate_partner_id'}"
                />
            <filter
                    name="address_id"
                    string="Lieu"
                    domain="[]"
                    context="{'group_by':'address_id'}"
                />
        </search>
    </field>
</record>

<record id="generate_certificate_act_server" model="ir.actions.server">
    <field name="name">Générer le(s) certificat(s)</field>
    <field name="model_id" ref="desktop_certificate.model_desktop" />
    <field name="binding_model_id" ref="desktop_certificate.model_desktop" />
    <field name="state">code</field>
    <field
            name="code"
        >action = model.browse(env.context['active_ids']).generate_certificate()</field>
</record>


<record id="desktop_action" model="ir.actions.act_window">
    <field name="name">Postes</field>
    <field name="res_model">desktop</field>
    <field name="view_mode">tree,form</field>
    <field name="context">{"active_test": False}</field>
</record>
<menuitem
        id="desktop_certificate_menu"
        name="Postes / Certificats"
        parent="base.menu_administration"
        sequence="3"
        action="desktop_certificate.desktop_action"
    />
</odoo>
