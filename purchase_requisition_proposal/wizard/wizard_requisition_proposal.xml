<?xml version="1.0" encoding="UTF-8" ?>
<!-- Copyright (C) 2023 Akretion (<http://www.akretion.com>).
     @author KÃ©vin Roche <kevin.roche@akretion.com>
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->
<odoo>
    <record id="requisition_proposal_wizard" model="ir.ui.view">
        <field name="model">requisition.proposal.wizard</field>
        <field name="arch" type="xml">
            <form>
                <group>
                    <field
                        name="proposal_line_ids"
                        nolabel="1"
                        options="{'no_create': True, 'reload_on_button': True}"
                    >
                        <tree create="false" delete="false" editable="bottom">
                            <field name="partner_id" readonly="1" />
                            <field name="product_id" readonly="1" />
                            <field name="purchase_id" invisible="1" />
                            <field
                                name="product_qty"
                                readonly="1"
                                decoration-info="1"
                            />
                            <field
                                name="product_uom_id"
                                readonly="1"
                                decoration-info="1"
                            />
                            <field
                                name="qty_proposed"
                                decoration-bf="1"
                                readonly="context.get('received_proposal')"
                                attrs="{'readonly':[('qty_planned', '!=', 0)]}"
                            />
                            <field
                                name="qty_planned"
                                decoration-danger="1"
                                readonly="context.get('my_proposal')"
                            />
                            <field
                                name="qty_check"
                                widget="badge"
                                decoration-success="qty_check == 'enough'"
                                decoration-warning="qty_check == 'not_enough'"
                                invisible="context.get('my_proposal')"
                            />
                            <field
                                name="schedule_date"
                                readonly="1"
                                decoration-info="1"
                            />
                            <field
                                name="date_planned"
                                decoration-bf="1"
                                readonly="context.get('received_proposal')"
                                attrs="{'readonly':[('qty_planned', '!=', 0)]}"
                            />
                            <field
                                name="date_check"
                                widget="badge"
                                decoration-success="date_check == 'respected'"
                                decoration-warning="date_check == 'not_respected'"
                                invisible="context.get('my_proposal')"
                            />
                            <field name="price_unit" readonly="1" decoration-info="1" />
                        </tree>
                    </field>
                </group>
                <footer>
                    <button
                        name="confirm_lines"
                        type="object"
                        string="Confirm"
                        class="btn-primary"
                    />
                    <button string="Discard" special="cancel" class="btn-secondary" />
                </footer>
            </form>
        </field>
    </record>
    <record model="ir.ui.view" id="requisition_proposal_buttons_wizard">
        <field name="name">requisition.proposal.wizard.buttons</field>
        <field name="model">requisition.proposal.wizard</field>
        <field name="inherit_id" ref="requisition_proposal_wizard" />
        <field name="priority">1000</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <xpath expr="//tree/field[@name='price_unit']" position="after">
                <button
                    string="Duplicate"
                    name="duplicate_line"
                    type="object"
                    attrs="{'invisible':[('qty_planned', '!=', 0)]}"
                />
                <button
                    string="Remove"
                    name="remove_line"
                    type="object"
                    attrs="{'invisible':[('qty_planned', '!=', 0)]}"
                />
            </xpath>
        </field>
    </record>
</odoo>
